@model YourCourses.FiddleExecuteModel
@{
    Layout = null;
}

<!DOCTYPE html>
<!-- template from http://getbootstrap.com/getting-started -->

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap 101 Test Template</title>

    <!-- CSS Includes -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <script src="~/Scripts/jquery-1.10.2.js"></script>
    <script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
    <script src="~/Scripts/codemirror-2.37/lib/codemirror.js"></script>
    <script src="~/Scripts/codemirror-2.37/mode/clike/clike.js" type="text/javascript"></script>
    <link href="~/Scripts/codemirror-2.37/lib/codemirror.css" rel="stylesheet" type="text/css" />
    <link href="~/Scripts/codemirror-2.37/theme/lesser-dark.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="~/Scripts/codemirror-2.37/lib/util/simple-hint.css">
    <link rel="stylesheet" href="~/Scripts/codemirror-2.37/lib/util/simple-hint.js">
    <link rel="stylesheet" href="~/Content/animate.css">
    <link rel="stylesheet" href="~/Content/style.css">

    <style type="text/css">
        .field-validation-error {
            color: #ff0000;
        }

        .CodeMirror-scroll {
            height: auto;
            overflow-y: hidden;
            overflow-x: auto;
        
        }
    

    </style>

</head>

<body>
    <button type="button" class="btn btn-default btn-lg btn-block animated zoomInUp" onclick="location.href='@Url.Action("Index", "CoursesList")'">Вернуться на страницу выбора курсов</button>
    <div class="container animated zoomInUp">
        <div>
            <h1>Прочтите задание и приступайте к выполнению</h1>
            @*Добавить вывод случайной практики из форич, а не первой(как сейчас)*@
            @using (Html.BeginForm())
            {

                @Html.Raw(Session["TEXT"].ToString())
                <div class="form-group">
                    @Html.TextArea("FirstPart", (string)Session["FP"])
                    @Html.Hidden("TEST", (string)Session["TEST"])
                    @*@Html.LabelFor(m => m.CodeBlock)*@
                    @Html.TextAreaFor(model => model.CodeBlock, new { @editable = true, @class = "form-control", rows = 20 })
                    @Html.TextArea("LastPart", (string)Session["LP"])
                </div>
                <p>Ограничение ввода: не более сотни вызовов в час с текущего IP</p>
                <button type="button" class="btn btn-success submit" data-toggle="modal" data-target="#myModal">Execute</button>
            }

            <br /><br />
            <div class="modal fade" id="myModal" role="dialog">
                <div class="modal-dialog">

                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Modal Header</h4>
                        </div>
                        <div class="modal-body">
                            <p>
                                <div class="alert alert-warning fade">
                                    <strong><span class="alert-content"></span></strong>
                                </div>

                            </p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>

                    @*<div class="alert alert-warning fade">
                        <strong><span class="alert-content"></span></strong>
                    </div>*@
                </div>
            </div>

            <!-- JS includes -->
            <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
            <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

            <script src="//ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
            <script src="//ajax.aspnetcdn.com/ajax/mvc/4.0/jquery.validate.unobtrusive.min.js"></script>

            <script type="text/javascript">
        var myValue = $('#' + '@(ViewBag.text)').val();

			function openAlert(txt) {
				$('.alert-content').html(txt);
				$('.alert').addClass('in');
			}

			function closeAlert() {
				$('.alert').removeClass('in');
			}

			$(function(){

				$('.submit').click(function(){
			console.log('yo');
					if($('form').valid()) {
                        text = editor.getValue();
						$.ajax({
                            url: '@Url.RouteUrl(new{ action="Execute", controller="Execute"})',
                            data: { code: text },
                    type: 'POST',
                    success: function (resp) {
                        openAlert(resp);
                    }
                });
            }
            else {
                closeAlert();
            }
                });

            });

            </script>
            <script>

                //CodeBlock
                var readOnlyCodeMirror = CodeMirror.fromTextArea(document.getElementById('FirstPart'), {
                    mode: "text/x-csharp",
                    theme: "default",
                    lineNumbers: false,
                    readOnly: true,
                    tabSize: 1

                });

                var readOnlyCodeMirror2 = CodeMirror.fromTextArea(document.getElementById('LastPart'), {
                    mode: "text/x-csharp",
                    theme: "default",
                    lineNumbers: false,
                    readOnly: true
                });
                var editor = CodeMirror.fromTextArea(document.getElementById("CodeBlock"), {
                    lineNumbers: true,
                    matchBrackets: true,
                    mode: "text/x-csharp",
                    compiler: true,
                    hint: true,
                    autohint: true,
                    extraKeys: { "Ctrl-Space": "autocomplete" },
                    theme: "lesser-dark"

                });

                var text = editor.getValue();



            </script>

</body>

</html>
